extends ../layouts/default

block append js
    script(src="/js/jquery/jquery.doubleScroll.js")
    script(src="/js/minionsCost.js")
    	
block append variables
    - var currentPage = "minionsCost";

block meta
    meta(name="description" content="Know your most profitable minions! Tailor made for each profile, fully accurate.")

mixin infoBox(id,type,title)
    if(type=="info")
        i.fas.fa-lg(data-toggle="modal" data-target="#"+id class="fa-info-circle")
    else if(type=="question")
        i.fas.fa-lg(data-toggle="modal" data-target="#"+id class="fa-question-circle")
    .modal.fade.infoBox(id=id tabindex="-1" role="dialog" aria-labelledby=id+"Label" aria-hidden="true")
        .modal-dialog(role="document" class=(type=="rightInfo"?"modal-xl":undefined))
            .modal-content
                .modal-header
                    h3.modal-title(id=id+"Label")=title
                    button.close(type="button" data-dismiss="modal" aria-label="Close")
                        span(aria-hidden="true") &times;
                .modal-body
                    if block 
                        block 
                    else
                        p Nothing to see here
                .modal-footer
                    button.btn.btn-secondary(type="button" data-dismiss="modal") Close

block content
    .container
        h1.d-inline-block MINIONS (COST) &nbsp;
        img.d-inline-block.align-top(src="/images/minions.png" width="40" height="40")
        p.d-inline-block &nbsp; &nbsp; &nbsp;
        +infoBox("minionsTitleModal","info","Minions Profit Calculator")
            //- p It calculates the profit generated by each minion.
            //- p What's so special is that it allows you to fully personalize its elements to become your own minion tier list based on your profile, which include minion tiers, form of products (even in e-block form!), whether or not diamond spreadings are equipped, and more.
            //- p It also calculates the profit based on bazaar prices directly obtained from the Hypixel API, so the prices are up-to-date.
            //- br
            //- h4 Disclaimer
            //- p As more people are using my website, I would like to explain more about how the minion profit calculator works and its limitations.
            //- p Please note that the minion profit calculator calculates based on the instantaneous price of the items sold at bazaar, so the prices may fluctuate a lot from time to time, and so do the minions profit (as we all know the economy of Skyblock is quite unstable). The "best minion" for money may not be the same some time later. I hope you all understand this uncertainty.
            //- p Overall speaking, snow minions and clay minions are the most stable for profit as their profits do not depend on the economy. If you would like to explore other relatively stable alternatives you may watch <a href="https://youtu.be/_LmqqJtsdrk"> ModernSoldier's video</a> for more advice.
        //-TEMP
        h3 Warning
        p This feature is in beta, bugs may occur.
        //- p Hypixel will be back on very soon. However, the Hypixel API, that HyMinions depends on, probably will not be available that soon. Therefore, the minion profit calculator and forge profit calculator would not be available for a short while even after Hypixel is on. 
        //- p However, I have made slight changes to the code so that it can calculate minions profit with NPC price. Even though the minions profit calculator will not be in full function, at least you can see the items that different minions generate.
        //- p Sorry for the inconvenience caused and I hope you would use my minion calculator again when both Hypixel and Hypixel API functions normally.
        //- p: a(href="minions/?sellingTo=0") Click here to check the calculator with NPC price
        #overall
            .row
                #general.col-lg-6.col-12
                    br
                    h3 General
                    .form-group
                        p Minecraft Name (optional): &nbsp; 
                            input#overallProfileName.form-control(value=settings.name)
                            +infoBox("profileModal","question","Why is my Minecraft name required?")
                            //- p If you enter your Minecraft name, it will calculate the profit based on the highest tier of the minion you have crafted. It could make the profit list more personalized and useful when finding the most profitable minions among those you have.
                            //- p Alternatively, you could uncheck this "Use Profile" box, and select the tier of the minions manually.
                        if(settings.profileNames)
                            label(for="overallProfileProfile") Profile: &nbsp;
                            select#overallProfileProfile.form-control
                                -let k=0
                                while k<settings.profileNames.length
                                    option(value=k selected=(settings.profile==k?'selected':undefined))=settings.profileNames[k]
                                    -k++;
                        
                .col-lg-6.col-12  
                    #advanced
                        br
                        h3 Advanced 
                        .form-group
                            label(for="overallBuyingFrom") Buying from: &nbsp;
                            select#overallBuyingFrom.form-control
                                option(value="1" selected=(settings.buyingFrom==1?'selected':undefined)) All sources (NPC or bazaar)
                                option(value="0" selected=(settings.buyingFrom==0?'selected':undefined)) NPC only
                        
                        .form-group
                            label(for="overallBuyingMethod") Buying method in bazaar: &nbsp;
                            select#overallBuyingMethod.form-control
                                option(value="1" selected=(settings.buyingMethod==1?'selected':undefined)) Buy instantly
                                option(value="0" selected=(settings.buyingMethod==0?'selected':undefined)) Buy order
                                
                        .form-group
                            label(for="overallTax") Tax in bazaar: &nbsp; 
                                input#overallTax.form-control(type="number" value=settings.tax min="0")
                                span &nbsp; %
            br
            button#overallSettings.btn(onclick="generateLink()") Apply
            br
            br

        #content
            hr
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            //- <!-- minions1 -->
            <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3541192882647315" data-ad-slot="6074503232" data-ad-format="auto" data-full-width-responsive="true"></ins>
            <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
            br
            if !minions || !settings
                h1 Error
                p.lead An unexpected error has occured.
                h3 Is Hypixel API down?
                p You could check to see if <a href="https://api.hypixel.net/skyblock/bazaar">this link</a> brings you to the raw bazaar data to see if Hypixel API is down.
                p If so, we could not calculate minions profit based on the latest bazaar price. However, you may try <a href="minions/?sellingTo=0">this set of settings</a> to obtain the minions profit in NPC price instead, until the Hypixel API is fixed.
                p You may make a bug report <a href="/contact">here</a> if the above set of settings also does not work. Sorry for the inconvenience caused.
            else if settings.hasError
                h1 Error
                p.lead=settings.errorMsg
                h3 Is Hypixel API down?
                p You could check to see if <a href="https://api.hypixel.net/skyblock/bazaar">this link</a> brings you to the raw bazaar data to see if Hypixel API is down.
                p If so, we could not calculate minions profit based on the latest bazaar price. However, you may try <a href="minions/?sellingTo=0">this set of settings</a> to obtain the minions profit in NPC price instead, until the Hypixel API is fixed.
                p You may make a bug report <a href="/contact">here</a> if the above set of settings also does not work. Sorry for the inconvenience caused.
            else
                #search: .form-group
                    label(for="searchInput") Search: &nbsp;
                    input#searchInput(list="searchDatalist").form-control
                    datalist#searchDatalist
                        each minion in minions
                            option(value=minion.name)
                    span &nbsp; &nbsp; &nbsp;
                    button#searchButton.btn(onclick="search()") Search
                #doubleScroll: table#minionsTable.table.table-dark.w-100
                    thead
                        tr
                            th(scope="col")
                            th(scope="col") Minion
                            th(scope="col") Tier
                            th(scope="col") Total Upgrade Cost
                            th(scope="col") Upgrade materials
                            th(scope="col") Number of Items
                            th(scope="col") Unit Price (Bazaar/AH)
                            th(scope="col") Total Upgrade Cost
                    -let i=0;
                    each minion in minions
                        tr(id="minion"+i+"Row" class=minion.hasIndividualSettings==1?"individualTableRow":null)
                            td.text-center
                                | ##{i+1}
                                br
                                img(src="/images/minions/"+minion.name+".png" width="30" height="30")
                            td(id="minion"+i+"Name")
                                | #{minion.name}
                                br
                                | (#{minion.totalProfitText})
                            td(id="minion"+i+"Tier")=minion.tier
                            td(id="minion"+i+"TotalCost")=minion.tier
                            td(id="minion"+i+"Items")
                                if minion.outputProducts
                                    each product in minion.outputProducts
                                        | #{product.name}
                                        br
                            td(id="minion"+i+"NumberOfItems")
                                if minion.outputProducts
                                    each product in minion.outputProducts
                                        | #{product.numberOfItems}
                                        br
                            td(id="minion"+i+"BazaarPrices")
                                if minion.outputProducts
                                    each product in minion.outputProducts
                                        | #{product.unitPrice}
                                        br
                            td(id="minion"+i+"TotalCost")=minion.totalProfitText
                        - i++;
                
                - i=0;
            p: small
                if(settings.lastUpdatedBazaar)
                    | Last updated time of bazaar price: #{settings.lastUpdatedBazaar} UTC
                if(settings.lastUpdatedProfile)
                    | <br /> Last updated time of profile: #{settings.lastUpdatedProfile} UTC