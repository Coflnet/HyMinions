extends ../layouts/default

block append js
    script(src="/js/jquery/jquery.doubleScroll.js")
    //- script(src="/js/minionsData.js")
    //- script(src="/js/minionsOperation.js")
    script(src="/js/minions.js")
    	
block append variables
    - var currentPage = "minions";
    - var numberOfMinions = 53;

block meta
    meta(name="description" content="Know your most profitable minions! Tailor made for each profile, fully accurate.")

mixin infoBox(id,type,title)
    i.fas.fa-lg(data-toggle="modal" data-target="#"+id class=(type=="info"?"fa-info-circle":"fa-question-circle"))
    .modal.fade.infoBox(id=id tabindex="-1" role="dialog" aria-labelledby=ud+"Label" aria-hidden="true")
                .modal-dialog(role="document")
                    .modal-content
                        .modal-header
                            h5.modal-title(id=id+"Label")=title
                            button.close(type="button" data-dismiss="modal" aria-label="Close")
                                span(aria-hidden="true") &times;
                        .modal-body
                            if block 
                                block 
                            else
                                p Nothing to see here
                        .modal-footer
                            button.btn.btn-secondary(type="button" data-dismiss="modal") Close

block content
    .container
        h1.d-inline-block MINIONS &nbsp;
        img.d-inline-block.align-top(src="/images/minions.png" width="40")
        p.d-inline-block &nbsp; &nbsp; &nbsp;
        +infoBox("minionsTitleModal","info","Minions Profit Calculator")
            p It calculates the profit generated by each minion.
            p What's so special is that it allows you to fully personalize its elements to become your own minion tier list based on your profile, which include minion tiers, form of products (even in e-block form!), whether or not diamond spreadings are equipped, and more.
            p It also calculates the profit based on bazaar prices directly obtained from the Hypixel API, so the prices are up-to-date.
            //- br
            //- p To use it, go to the <a href="/minions">minions tab</a>. Type in your Minecraft IGN in the first input box (or simply leave it if you have fully maxed minions), and click "Apply Overall Changes". You will then see a list of all minions, ranked by the amount of profit it generates. The number below each minion is the profit per hour, assuming you sell the items to the bazaar. You can also see the item(s) each minion gives.
            //- p The default settings should be fine for most of you. Of course you can try out different settings based on your own playstyle.
            br
            h4 Disclaimer
            p As more people are using my website, I would like to explain more about how the minion profit calculator works and its limitations.
            p Please note that the minion profit calculator calculates based on the instantaneous price of the items sold at bazaar, so the prices may fluctuate a lot from time to time, and so do the minions profit (as we all know the economy of Skyblock is quite unstable). The "best minion" for money may not be the same some time later. I hope you all understand this uncertainty.
            p Overall speaking, snow minions and clay minions are the most stable for profit as their profits do not depend on the economy. If you would like to explore other relatively stable alternatives you may watch <a href="https://youtu.be/_LmqqJtsdrk"> ModernSoldier's video</a> for more advice.
        #overall
            .row
                #general.col-lg-6.col-12
                    br
                    h3 General
                    .form-group
                        //-pretick use profile to be true for first time visit
                        input#overallUseProfile.checkbox(type="checkbox" onchange="toggleUseProfile()" checked=(settings.useProfile==false&&(settings.tier!=11) ? undefined:"checked")) 
                        label(for="overallUseProfile") &nbsp; Use Profile  &nbsp; 
                        +infoBox("profileModal","question","Why is my Minecraft name required?")
                            p If you enter your Minecraft name, it will calculate the profit based on the highest tier of the minion you have crafted. It could make the profit list more personalized and useful when finding the most profitable minions among those you have.
                            p Alternatively, you could uncheck this "Use Profile" box, and select the tier of the minions manually.
                    .form-group#useProfile(class=(settings.useProfile==false&&(settings.tier!=11) ? "d-none":""))
                        p Minecraft Name: &nbsp; 
                            input#overallProfileName.form-control(value=settings.name)
                        if(settings.profileNames)
                            label(for="overallProfileProfile") Profile: &nbsp;
                            select#overallProfileProfile.form-control
                                -let k=0
                                while k<settings.profileNames.length
                                    option(value=k selected=(settings.profile==k?'selected':undefined))=settings.profileNames[k]
                                    -k++;
                    
                    .form-group#useTier(class=(settings.useProfile==false&&(settings.tier!=11) ? "":"d-none"))
                        label(for="overallTier") Tier: &nbsp;
                        select#overallTier.form-control
                            -let j=1
                            while j<=11
                                option(selected=(settings.tier==j ? 'selected':undefined))=j
                                -j++;
                            option(selected=(settings.tier==12 ? 'selected':undefined) value="12") 11/12
                    .form-group
                        p Fuel/ other perks: &nbsp; 
                            input#overallFuel.form-control(type="number" value=settings.fuel min="0")
                            span &nbsp; %
                    .form-group
                        label(for="overallCalculationType") Calculation mode: &nbsp;  
                        select#overallCalculationType.form-control(onchange="toggleCalculationType()")
                            option(value="0" selected=(settings.calculationType==0?'selected':undefined)) Old
                            option(value="1" selected=(settings.calculationType==1?'selected':undefined)) New (based on offline duration)
                        span &nbsp; 
                            +infoBox("calculationTypeModal","question","Calculation Modes")
                                h4 New calculation mode
                                p It calculates the profit based on your frequency of collecting minions. For example, lapis minions could be a good minion for active players, who collect enchanted lapis before they are automatically converted into enchanted lapis blocks, but not for those who are less active.
                                h4 Old calculation mode
                                p The original calculation mode â€“ It calculates the profit based on a particular enchanted form of every product. (e.g. first enchanted form/ most profitable enchanted form) It does not calculate based on your offline duration.

                    #autoCalculationType(class=(settings.calculationType==1 ? "":"d-none"))
                        .form-group
                            p Offline time: &nbsp; 
                                input#overallOfflineTime.form-control(type="number" value=settings.offlineTimeUnit==1?settings.offlineTime/24:settings.offlineTime min="0")
                                span &nbsp;
                                select#overallOfflineTimeUnit.form-control
                                    option(value="0" selected=(settings.offlineTimeUnit==0?'selected':undefined)) hour(s)
                                    option(value="1" selected=(settings.offlineTimeUnit==1?'selected':undefined)) day(s)
                        br
                        h3 Experimental Features
                        .form-group
                            //-pretick use profile to be true for first time visit
                            input#overallSoulflow.checkbox(type="checkbox" checked=settings.soulflow? "checked":undefined) 
                            label(for="overallSoulflow") &nbsp; Use Lesser Soulflow Engine &nbsp; 
                            +infoBox("soulflowModal","question","Lesser Soulflow Engine")
                                h4 Info
                                p Copied from <a href='https://hypixel-skyblock.fandom.com/wiki/Lesser_Soulflow_Engine'>Skyblock Wiki</a>: 
                                p The Lesser Soulflow Engine can be used as a minion upgrade. When it is added to a minion, its output will be reduced by 50%. Every 3.6 minutes (220 seconds), it will produce 1x Raw Soulflow. This production rate is unaffected by minion speed, minion Crystals nor Minion Fuel. Minions containing a Lesser Soulflow Engine will have purple particles above them.
                                p The Lesser Soulflow Engine requires Enderman Slayer level 2 to use.
                                h4 Technical Details
                                p For easy implementation for the time being, when the Lesser Soulflow Engine checkbox is checked: 
                                ul
                                    li Lesser Soulflow Engine would be added regardless of the existing minion upgrades, so the profits may be inaccurate.
                                    li This feature only works for the new calculation type
                                    li Cannot modify Soulflow through individual minion settings
                                p This function is in beta, bugs may occur.
                .col-lg-6.col-12  
                    #advanced
                        br
                        h3 Advanced 
                        #manualCalculationType(class=(settings.calculationType==0 ? "":"d-none"))
                            .form-group
                                label(for="overallProductForm") Products form: &nbsp;
                                select#overallProductForm.form-control
                                    option(value="-2" selected=(settings.productForm==-2?'selected':undefined)) Max profit (enchanted forms)
                                    option(value="-1" selected=(settings.productForm==-1?'selected':undefined)) Max profit
                                    option(value="0" selected=(settings.productForm==0?'selected':undefined)) Unenchanted form
                                    option(value="1" selected=(settings.productForm==1?'selected':undefined)) First enchanted form
                                    option(value="2" selected=(settings.productForm==2?'selected':undefined)) Second enchanted form (if applicable)
                            .form-group
                                label(for="overallDiamondSpreadingDwarvenCompactor") Diamond Spreading: &nbsp;
                                select#overallDiamondSpreadingDwarvenCompactor.form-control
                                    option(value="0" selected=(settings.diamondSpreading==0?'selected':undefined)) None
                                    option(value="1" selected=(settings.diamondSpreading==1||settings.diamondSpreading==3?'selected':undefined)) Diamond spreading only
                                    option(value="2" selected=(settings.diamondSpreading==2?'selected':undefined)) Diamond spreading + Dwarven compactor
                                span &nbsp; 
                                    +infoBox("diamondSpreadingDwarvenCompactorModal","question","Diamond Spreading and Dwarven Super Compactor")
                                        h4 Diamond Spreading
                                        p A minion upgrade that makes the minion generates 1 diamond every 10 items produced as a bonus, hence increasing the profit significantly for some of the minions, such as snow minions. 
                                        p You could refer to the <a href='https://hypixel-skyblock.fandom.com/wiki/Diamond_Spreading'>Skyblock wiki</a> for more information.
                                        h4 Dwarven Super Compactor
                                        p It is a super compactor 3000 and a super smelter all-in-one. It allows more minions, such as iron minion, to equip diamond spreading and increase their profits as a result.
                                        p You could refer to the <a href='https://hypixel-skyblock.fandom.com/wiki/Dwarven_Super_Compactor'>Skyblock wiki</a> for more information.

                        #autoCalculationTypeAdvanced(class=(settings.calculationType==1 ? "":"d-none"))
                            .form-group
                                input#overallDiamondSpreading.checkbox(type="checkbox" checked=(settings.diamondSpreading>=1 ? 'checked' : undefined))
                                label(for="overallDiamondSpreading") &nbsp; Has Diamond Spreading &nbsp;
                                +infoBox("diamondSpreadingModal","question","Diamond Spreading")
                                    p.
                                        A minion upgrade that makes the minion generates 1 diamond every 10 items produced as a bonus, hence increasing the profit significantly for some of the minions, such as snow minions. 
                                        You could refer to the <a href='https://hypixel-skyblock.fandom.com/wiki/Diamond_Spreading'>Skyblock wiki</a> for more information.
                            .form-group
                                label(for="overallSuperCompactor") Compactor: &nbsp;
                                select#overallSuperCompactor.form-control(onchange="toggleMinionChest()")
                                    option(value="0" selected=(settings.superCompactor==0?'selected':undefined)) None/ Compactor
                                    //-option(value="1" selected=(settings.superCompactor==1?'selected':undefined)) Compactor
                                    option(value="2" selected=(settings.superCompactor==2?'selected':undefined)) Super Compactor 3000
                                    option(value="3" selected=(settings.superCompactor==3?'selected':undefined)) Dwarven Super Compactor
                                span &nbsp; 
                                    +infoBox("superCompactorModal","question","Different Compactors")
                                        h4 Compactor
                                        p A minion upgrade for early game players which compacts items into their block form. This only works for certain minions like diamond minions and emerald minions. It increases the minion storage.
                                        p It is normal that the calculator recommends selling the items in the enchanted form rather than the base form, as the enchanted forms may sell more than the base form. You could always convert the product blocks into their respective enchanted form. Alternatively, you could also change the product blocks back into their base form and sell them to the bazaar for most of the product blocks.
                                        p You could refer to the <a href='https://hypixel-skyblock.fandom.com/wiki/Compactor'>Skyblock wiki</a> for more information.
                                        
                                        h4 Super Compactor 3000
                                        p A minion upgrade for mid to late game players which compacts items into their enchanted form. You cannot covert the enchanted items back to original items, therefore, it may affect the total profit. The calculator would take this factor into account and calculate the profit accurately.
                                        p You could refer to the <a href="https://hypixel-skyblock.fandom.com/wiki/Super_Compactor_3000">Skyblock wiki</a> for more information.

                                        h4 Dwarven Super Compactor
                                        p It is a super compactor 3000 and a super smelter all-in-one. It allows more minions, such as iron minion, to equip diamond spreading and increase their profits as a result.
                                        p You could refer to the <a href='https://hypixel-skyblock.fandom.com/wiki/Dwarven_Super_Compactor'>Skyblock wiki</a> for more information.
                            //- #minionChest(class=(settings.superCompactor<=1 ? "":"d-none"))
                            //-     .form-group
                            //-         label(for="overallMinionChest") Minion Chest: &nbsp;
                            //-         select#overallMinionChest.form-control
                            //-             option(value="0" selected=(settings.minionChest==0?'selected':undefined)) None
                            //-             option(value="3" selected=(settings.minionChest==3?'selected':undefined)) Small Storage
                            //-             option(value="9" selected=(settings.minionChest==9?'selected':undefined)) Medium Storage
                            //-             option(value="15" selected=(settings.minionChest==15?'selected':undefined)) Large Storage
                            //-             option(value="21" selected=(settings.minionChest==21?'selected':undefined)) X-Large Storage
                            //-             option(value="27" selected=(settings.minionChest==27?'selected':undefined)) XX-Large Storage
                            //-     .form-group
                            //-         label(for="overallAutomaticShipping") Automated Shipping: &nbsp;
                            //-         select#overallAutomaticShipping.form-control
                            //-             option(value="0" selected=(settings.automaticShipping==0?'selected':undefined)) None
                            //-             option(value="0.5" selected=(settings.automaticShipping==0.5?'selected':undefined)) Budget Hopper
                            //-             option(value="0.9" selected=(settings.automaticShipping==0.9?'selected':undefined)) Enchanted Hopper
                        
                    
                        
                        br
                        #miscellaneousInline
                            h3 Miscellaneous &nbsp;
                            a.read-more(data-toggle="collapse" href="#miscellaneous" aria-expanded="false" aria-controls="miscellaneous")
                                span.collapsed Show more
                                span.expanded Show less
                        #miscellaneous.collapse
                            .form-group
                                label(for="overallSellingTo") Selling to: &nbsp;
                                select#overallSellingTo.form-control
                                    option(value="1" selected=(settings.sellingTo==0?'selected':undefined)) Max profit (NPC or bazaar)
                                    option(value="0" selected=(settings.sellingTo==-1?'selected':undefined)) NPC only
                            .form-group
                                label(for="overallSellingMethod") Selling method in bazaar: &nbsp;
                                select#overallSellingMethod.form-control
                                    option(value="1" selected=(settings.sellingMethod==1?'selected':undefined)) Sell instantly
                                    option(value="0" selected=(settings.sellingMethod==0?'selected':undefined)) Sell offer
                                    
                            .form-group
                                p Tax in bazaar: &nbsp; 
                                    input#overallTax.form-control(type="number" value=settings.tax min="0")
                                    span &nbsp; %
            br
            button#overallSettings.btn(onclick="generateLink()") Apply
            br
            br

        #content
            hr
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            //- <!-- minions1 -->
            <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-3541192882647315" data-ad-slot="6074503232" data-ad-format="auto" data-full-width-responsive="true"></ins>
            <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
            br
            if !minions || !settings
                h1 Error
                p.lead An unexpected error has occured. You may make a bug report <a href="/contact">here</a>.
            else if settings.hasError
                h1 Error
                p.lead=settings.errorMsg

            else
                #search: .form-group
                    label(for="searchInput") Search: &nbsp;
                    input#searchInput(list="searchDatalist").form-control
                    datalist#searchDatalist
                        each minion in minions
                            option(value=minion.name)
                    span &nbsp; &nbsp; &nbsp;
                    button#searchButton.btn(onclick="search()") Search
                #doubleScroll: table#minionsTable.table.table-dark.w-100
                    thead
                        tr
                            th(scope="col")
                            th(scope="col") 
                                if settings.calculationType==0
                                    | Minion (Profit Per Hour)
                                else
                                    | Minion (Total Profit)
                            th(scope="col") Tier
                            th(scope="col" class="tools") Minion Upgrades
                            th(scope="col") Items
                            th(scope="col") Number of Items
                            th(scope="col") Unit Price (Bazaar)
                            if settings.calculationType==1
                                th(scope="col") Total Profit
                            th(scope="col") Profit Per Hour
                            th(scope="col")
                    -let i=0;
                    each minion in minions
                        tr(id="minion"+i+"Row" class=minion.hasIndividualSettings==1?"individualTableRow":null)
                            td.text-center
                                | ##{i+1}
                                br
                                img(src="/images/minions/"+minion.name+".png" width="30")
                            td(id="minion"+i+"Name")
                                | #{minion.name}
                                br
                                | (#{minion.totalProfitText})
                            td(id="minion"+i+"Tier")=minion.tier
                            td(id="minion"+i+"Tools" class=minion.toolsWarning? "warning" : null class="tools")
                                if minion.tools
                                    each tool in minion.tools
                                        | #{tool}
                                        br
                            td(id="minion"+i+"Items")
                                if minion.outputProducts
                                    each product in minion.outputProducts
                                        | #{product.name}
                                        br
                            td(id="minion"+i+"NumberOfItems")
                                if minion.outputProducts
                                    each product in minion.outputProducts
                                        | #{product.numberOfItems}
                                        br
                            td(id="minion"+i+"BazaarPrices")
                                if minion.outputProducts
                                    each product in minion.outputProducts
                                        | #{product.unitPrice}
                                        br
                            td(id="minion"+i+"TotalProfit")=minion.totalProfitText
                            if settings.calculationType==1
                                td(id="minion"+i+"ProfitPerHour")=minion.profitPerHour
                            td(id="minion"+i+"Settings"): button.btn.btn-blue(id="individualSettings"+i data-toggle="modal" data-target="#individualModal"+i) Settings

                        - i++;
                
                - i=0;
                each minion in minions
                    .individualModal.modal.fade(id="individualModal"+i tabindex="-1" role="dialog" aria-labelledby="individualModalLabel"+i aria-hidden="true")
                        .modal-dialog(role="document")
                            .modal-content(id="individualSettingsForm"+minion.id)
                                    .modal-header
                                        h5.modal-title(id="#individualModalLabel"+i)=minion.name
                                        button.close(type="button" data-dismiss="modal" aria-label="Close")
                                            span(aria-hidden="true") &times;
                                    .modal-body
                                        p This function is in beta, bugs may occur.
                                        .form-group
                                            label(for=minion.id+"individualTier") Tier: &nbsp;
                                            select(id=minion.id+"individualTier").form-control
                                                -let j=1;
                                                while j<=minion.tierDelay.length
                                                    option(selected=(minion.tier==j ? 'selected':undefined))=j
                                                    -j++;
                                        - let k=0;
                                        p Products:
                                        each product in minion.products
                                            .form-group
                                                label(for=minion.id+"individualProduct"+k) #{product.item}: &nbsp;
                                                select(id=minion.id+"individualProduct"+k).form-control
                                                    -let l=0;
                                                    each variant in product.variants
                                                        option(value=l selected=(product.selectedVariant==l? 'selected': undefined))=variant
                                                        - l++;
                                                    option(value=-1 selected=(product.selectedVariant==-1? 'selected': undefined)) No #{product.item}
                                                -k++;

                                            
                                            //-p More features coming soon, such as allowing you to change product forms or only allowing certain products to produce.

                                    .modal-footer
                                        button.btn.btn-secondary(type="button" data-dismiss="modal") Cancel
                                        button.btn.btn-warning(type="button" onclick="appendLink("+minion.id+")") Apply
                    - i++;
            p: small
                if(settings.lastUpdatedBazaar)
                    | Last updated time of bazaar price: #{settings.lastUpdatedBazaar} UTC
                if(settings.lastUpdatedProfile)
                    | <br /> Last updated time of profile: #{settings.lastUpdatedProfile} UTC
  
//- .form-group
//-     p Fuel: &nbsp; <input id="individualFuel" type="number" value="25" class="form-control" min="0"/> %
//- .form-group
//-     input#individualDiamondSpreading.checkbox(type="checkbox" checked onchange="toggleIndividualDiamondSpreading()")
//-     label(for="individualDiamondSpreading") &nbsp; Has Diamond Spreading
//- .form-group#products
//-     label Form of products:
//-     br
//-     -let m = 0;
//-     -let n = 0;
//-     while m<10
//-         select(id="individualProduct"+m).form-control
//-             -n=0;
//-             while n<5
//-                 option(id="individualProduct"+m+"Option"+n value=n)
//-                 -n++;
//-         -m++;
//-     select(id="individualProductDiamondSpreading").form-control
//-         -n=0;
//-         while n<3
//-             option(id="individualProductDiamondSpreadingOption"+n value=n)
//-             -n++;
//- .form-group
//-     label(for="individualSellingTo") Selling to: &nbsp;
//-     select#individualSellingTo.form-control
//-         option(value="0") Max profit (NPC or bazaar)
//-         option(value="1") Bazaar only
//-         option(value="-1") NPC only
//- .form-group
//-     label(for="individualSellingMethod") Selling method in bazaar: &nbsp;
//-     select#individualSellingMethod.form-control
//-         option(value="0") Sell offer
//-         option(value="1") Sell instantly